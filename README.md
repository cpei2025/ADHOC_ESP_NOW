
# ESP-NOW Adhoc Peer v1
## Cloud Power Electric Industries（雲力電工） - 2025


# 特徴
ESP_NOW_Peerクラスを使った、アドホックネットワークプログラムだよ。
ESP_NOWだから、AP不要で、空間内にあるESP32同士を自動でユニキャスト接続できるよ。
ESP_NOW　V2の環境なら、 1470byteまで遅れるよ。コンパイル環境がV2かどうかは、起動時にシリアルで確認してね。
グループUUIDが同じ端末を自動でピアリングして、ユニキャストで通信するよ。
サーバー1台で他はクライアントだけのスター型のシステムはもちろん、サーバー複数かつクライアント複数の複雑なアドホックも簡単にできるよ。
設定を全部サーバーにすれば、全員が双方向でつながるよ。
ハートビートでクライアントの状態監視も行い、接続が切れた場合も、切れたESP32の環境が復旧すれば自動接続するよ。
設定に必要なのは、各ESP32ごとに、クライアントと、サーバー、グループUUIDだけのシンプル設計。
UUIDをグループIDにして自動接続しているから、他のグループとの衝突はほぼないよ。
暗号化モードにも対応。暗号化モード設定と鍵を設定するだけで使えるよ。ただし、暗号化の時は台数が少ないから気をつけてね。

# 安全性
暗号化モードでのユニキャスト時の安全性を強化
登録アドバタイジングのグループUUIDとピア登録後のユニキャストのUUIDは別にしているので、暗号化モードの場合、ユニキャストのUUIDは暗号化して公開されないから安全だよ
  
# Flow
1. ブロードキャストでアドバタイジングパケットの送信（アドバタイジンググループUUIDを利用）
2. 同一グループUUIDの端末が受信すると、自動ピア登録（グループUUIDを利用）
3. 登録後はユニキャスト通信でハートビートを送って、通信を確立


このモデルに、センサーを組み合わせてIOTメッシュネットワークを作るも、アドホックで災害時に活躍するドローンロボットを作るも、クラサバのラジコンを作るも、君次第だよ。

